import {SIMULATOR_CONNECTION_STATE, SIMULATOR_TEST} from "../state_modules/simulatorInfoState";
import {useTranslation} from "react-i18next";
import '../components/Modal';
import {useSelector} from "react-redux";
import {useEffect, useState} from "react";

const DashboardPage = ({simulators}) => {
    const [t, i18n] = useTranslation('common');

    const [testSeqNameData, setTestSeqNameData] = useState();
    const [testSeqListData, setTestSeqListData] = useState();

    useEffect(() => {
        setTestSeqNameData({
            [SIMULATOR_TEST.normalOperation_low]: t('simulator.testSequence.normalOperation') + "(Low)",
            [SIMULATOR_TEST.normalOperation_normal]: t('simulator.testSequence.normalOperation') + "(Normal)",
            [SIMULATOR_TEST.normalOperation_high]: t('simulator.testSequence.normalOperation') + "(High)",
            [SIMULATOR_TEST.groundFault_low]: t('simulator.testSequence.groundFault') + "(Low)",
            [SIMULATOR_TEST.groundFault_normal]: t('simulator.testSequence.groundFault') + "(Normal)",
            [SIMULATOR_TEST.groundFault_high]: t('simulator.testSequence.groundFault') + "(High)",
            [SIMULATOR_TEST.blockProtectionConductor_low]: t('simulator.testSequence.blockProtectiveConductor') + "(Low)",
            [SIMULATOR_TEST.blockProtectionConductor_normal]: t('simulator.testSequence.blockProtectiveConductor') + "(Normal)",
            [SIMULATOR_TEST.blockProtectionConductor_high]: t('simulator.testSequence.blockProtectiveConductor') + "(High)",
            [SIMULATOR_TEST.shortControlCircuit_low]: t('simulator.testSequence.ShortControlCircuit') + "(Low)",
            [SIMULATOR_TEST.shortControlCircuit_normal]: t('simulator.testSequence.ShortControlCircuit') + "(Normal)",
            [SIMULATOR_TEST.shortControlCircuit_high]: t('simulator.testSequence.ShortControlCircuit') + "(High)",
            [SIMULATOR_TEST.diodeFault_low]: t('simulator.testSequence.diodeFault') + "(Low)",
            [SIMULATOR_TEST.diodeFault_normal]: t('simulator.testSequence.diodeFault') + "(Normal)",
            [SIMULATOR_TEST.diodeFault_high]: t('simulator.testSequence.diodeFault') + "(High)",
            [SIMULATOR_TEST.ccid_low]: t('simulator.testSequence.CCID20') + "(Low)",
            [SIMULATOR_TEST.ccid_normal]: t('simulator.testSequence.CCID20') + "(Normal)",
            [SIMULATOR_TEST.ccid_high]: t('simulator.testSequence.CCID20') + "(High)",
        });

        setTestSeqListData({
            "1": [
                t('simulator.standby'),
                t('simulator.testSequence.begin'),
                t('simulator.testSequence.connect'),
                t('simulator.testSequence.charging'),
                t('simulator.testSequence.chargingDone'),
                t('simulator.testSequence.disconnect'),
                t('simulator.testSequence.complete')
            ],
            "2": [
                t('simulator.standby'),
                t('simulator.testSequence.begin'),
                t('simulator.testSequence.connect'),
                t('simulator.testSequence.groundFault'),
                t('simulator.testSequence.complete')
            ],
            "3": [
                t('simulator.standby'),
                t('simulator.testSequence.begin'),
                t('simulator.ctestSequence.connect'),
                t('simulator.testSequence.charging'),
                t('simulator.testSequence.blockProtectiveConductor'),
                t('simulator.ctestSequence.complete')
            ],
            "4": [
                t('simulator.standby'),
                t('simulator.testSequence.begin'),
                t('simulator.testSequence.connect'),
                t('simulator.testSequence.charging'),
                t('simulator.testSequence.shortCircuit'),
                t('simulator.testSequence.complete')
            ],
            "5": [
                t('simulator.standby'),
                t('simulator.testSequence.begin'),
                t('simulator.testSequence.connect'),
                t('simulator.testSequence.diodeFault'),
                t('simulator.testSequence.complete')
            ],
            "6": [
                t('simulator.standby'),
                t('simulator.testSequence.begin'),
                t('simulator.testSequence.connect'),
                t('simulator.testSequence.charging'),
                t('simulator.testSequence.CCID'),
                t('simulator.testSequence.disconnect'),
                t('simulator.testSequence.complete')
            ],
        });
    }, []);

    const chargers = useSelector(state => state.chargerInfoState.chargers);

    const getInfoForState = (simul) => {

        let charger = {
            ChargerID: 0,
            ModelNo: "No charger selected",
            ModelName: "No charger selected",
            SerialNo: '9999-9999-9999',
        };

        chargers.map((e, i) => {
            if(e.ChargerID === simul.chargerId) {
                charger = e;
            }
        });

        switch (simul.state) {
            case SIMULATOR_CONNECTION_STATE.noInfo:
                return(
                    <div className="dashboard_box">
                        <div className="dashboard_box_title">
                            <div className="simulator_status">
                                <img src="style/img/sub/img_connection.png" alt="no connect"/>
                                    <p className="text_blue">{t('dashBoard.status.connected')}</p>
                            </div>
                            <h2>{`Simulator ${simul.id}`}</h2>
                        </div>
                        <div className="dashboard_box_con">
                            <div className="dashboard_box_alert">{t('dashBoard.msg.noInfoMsg')}</div>
                        </div>
                    </div>
                )
            case SIMULATOR_CONNECTION_STATE.disconnected:
                return (
                    <div className="dashboard_box">
                        <div className="dashboard_box_title">
                            <div className="simulator_status">
                                <img src="style/img/sub/img_no_connection.png" alt="no connect"/>
                                    <p className="text_red">{t('dashBoard.status.disconnected')}</p>
                            </div>
                            <h2>{`Simulator ${simul.id}`}</h2>
                        </div>
                        <div className="dashboard_box_con">
                            <div className="dashboard_box_alert text_red">{t('dashBoard.msg.noConnectMsg')}</div>
                        </div>
                    </div>
                )
            case SIMULATOR_CONNECTION_STATE.connected:
                return (
                    <div className="dashboard_box">
                        <div className="dashboard_box_title">
                            <div className="simulator_status">
                                <img src="style/img/sub/img_connection.png" alt="no connect"/>
                                    <p className="text_blue">{t('dashBoard.status.connected')}</p>
                            </div>
                            <h2>
                                {`${simul.simulatorName}`}
                                <p>{charger.ModelNo.content}</p>
                            </h2>
                        </div>
                        <div className="dashboard_box_con">
                            <div className="dashboard_box_text">
                                <div className="dashboard_box_text_detail">
                                    <span>{t('dashBoard.msg.chargerModelName')}</span>{charger.ModelName.content}</div>
                                <div className="dashboard_box_text_detail"><span>Test</span>-</div>
                                <div className="dashboard_box_text_detail">
                                    <p><span>Volt. </span>{simul &&simul.voltage === 0 ? '-' : simul.voltage + 'V'}</p>
                                    <p><span>Curr. </span>{simul &&simul.current === 0 ? '-' : simul.current + 'A'}</p>
                                    <p><span>PWM_MAX. </span>{simul &&simul.pwmMax === 0 ? '-' : simul.pwmMax + 'V'}</p>
                                    <p><span>PWM_MIN. </span>{simul &&simul.pwmMin === 0 ? '-' : simul.pwmMin + 'V'}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                )
            case SIMULATOR_CONNECTION_STATE.fail:
                return (
                    <div className="dashboard_box">
                        <div className="dashboard_box_title">
                            <div className="simulator_status">
                                <img src="style/img/sub/img_connection.png" alt="no connect"/>
                                    <p className="text_blue">Connect</p>
                            </div>
                            <h2>
                                {`${simul.simulatorName}`}
                                <p>{charger.ModelNo.content}</p>
                            </h2>
                        </div>
                        <div className="dashboard_box_con">
                            <div className="dashboard_box_text">
                                <div className="dashboard_box_text_detail">
                                    <span>{t('dashBoard.msg.chargerModelName')} </span>{charger.ModelName.content}</div>
                                <div className="dashboard_box_text_detail">
                                    <span>Test</span>{testSeqNameData && testSeqListData && simul.test != "0"? `${testSeqNameData[simul.test]} - ${testSeqListData[(simul.test).charAt(0)][simul.sequence]}` : ''}</div>
                                <div className="dashboard_box_text_detail">
                                    <p><span>Volt. </span>{simul && simul.voltage === 0 ? '-' : simul.voltage + 'V'}</p>
                                    <p><span>Curr. </span>{simul &&simul.current === 0 ? '-' : simul.current + 'A'}</p>
                                    <p><span>PWM_MAX. </span>{simul &&simul.pwmMax === 0 ? '-' : simul.pwmMax + 'V'}</p>
                                    <p><span>PWM_MIN. </span>{simul &&simul.pwmMin === 0 ? '-' : simul.pwmMin + 'V'}</p>
                                </div>
                            </div>
                            <div className="dashboard_box_footer">
                                <div className="test_status">
                                    <img src="style/img/sub/img_test_loader.gif" alt="test"/>
                                        <p className="text_yellow">test</p>
                                </div>
                                <div className="simulator_result">
                                    <span className="text_red">{t('simulator.fail')}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                )
            case SIMULATOR_CONNECTION_STATE.success:
                return (
                    <div className="dashboard_box">
                        <div className="dashboard_box_title">
                            <div className="simulator_status">
                                <img src="style/img/sub/img_connection.png" alt="test"/>
                                    <p className="text_blue">Connect</p>
                            </div>
                            <h2>
                                {`${simul.simulatorName}`}
                                <p>{charger.ModelNo.content}</p>
                            </h2>
                        </div>
                        <div className="dashboard_box_con">
                            <div className="dashboard_box_text">
                                <div className="dashboard_box_text_detail">
                                    <span>{t('dashBoard.msg.chargerModelName')} </span>{charger.ModelName.content}</div>
                                <div className="dashboard_box_text_detail">
                                    <span>Test</span>{testSeqNameData && testSeqListData  && simul.test != "0"? `${testSeqNameData[simul.test]} - ${testSeqListData[(simul.test).charAt(0)][simul.sequence]}` : ''}</div>
                                <div className="dashboard_box_text_detail">
                                    <p><span>Volt. </span>{simul &&simul.voltage === 0 ? '-' : simul.voltage + 'V'}</p>
                                    <p><span>Curr. </span>{simul &&simul.current === 0 ? '-' : simul.current + 'A'}</p>
                                    <p><span>PWM_MAX. </span>{simul &&simul.pwmMax === 0 ? '-' : simul.pwmMax + 'V'}</p>
                                    <p><span>PWM_MIN. </span>{simul &&simul.pwmMin === 0 ? '-' : simul.pwmMin + 'V'}</p>
                                </div>
                            </div>
                            <div className="dashboard_box_footer">
                                <div className="test_status">
                                    <img src="img/sub/img_finish.png" alt="finish"/>
                                        <p className="text_grey">Finish</p>
                                </div>
                                <div className="simulator_result">
                                    <span className="text_Success">Success</span>
                                </div>
                            </div>
                            <div className="dashboard_box_footer_btn">
                                <button type="button" className="btn btn_black" title="Result">Result</button>
                            </div>
                        </div>
                    </div>
                )
            case SIMULATOR_CONNECTION_STATE.inProgress:
                return (
                    <div className="dashboard_box">
                        <div className="dashboard_box_title">
                            <div className="simulator_status">
                                <img src="style/img/sub/img_connection.png" alt="test"/>
                                    <p className="text_blue">Connect</p>
                            </div>
                            <h2>
                                {`${simul.simulatorName}`}
                                <p>{charger.ModelNo.content}</p>
                            </h2>
                        </div>
                        <div className="dashboard_box_con">
                            <div className="dashboard_box_text">
                                <div className="dashboard_box_text_detail">
                                    <span>{t('dashBoard.msg.chargerModelName')} </span>{charger.ModelName.content}</div>
                                <div className="dashboard_box_text_detail">
                                    <span>Test</span>{testSeqNameData && testSeqListData && simul.test != "0" ? `${testSeqNameData[simul.test]} - ${testSeqListData[(simul.test).charAt(0)][simul.sequence]}` : ''}</div>
                                <div className="dashboard_box_text_detail">
                                    <p><span>Volt. </span>{simul &&simul.voltage === 0 ? '-' : simul.voltage + 'V'}</p>
                                    <p><span>Curr. </span>{simul &&simul.current === 0 ? '-' : simul.current + 'A'}</p>
                                    <p><span>PWM_MAX. </span>{simul &&simul.pwmMax === 0 ? '-' : simul.pwmMax + 'V'}</p>
                                    <p><span>PWM_MIN. </span>{simul &&simul.pwmMin === 0 ? '-' : simul.pwmMin + 'V'}</p>
                                </div>
                            </div>
                            <div className="dashboard_box_footer">
                                <div className="test_status">
                                    <img src="style/img/sub/img_test_loader.gif" alt="test"/>
                                        <p className="text_yellow">test</p>
                                </div>
                            </div>
                        </div>
                    </div>
                )
        }
    }

    return (
        <div className="contents_wrap scrollbar_custom">
            <div className="dashboard">
                {simulators.map((simulator) =>
                    <div className="dashboard_box_wrap" key = {simulator.id}>
                        { getInfoForState(simulator)}
                    </div>
                )}
            </div>
        </div>
    )

}

export default DashboardPage;